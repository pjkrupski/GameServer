<html>
<head>
<meta charset="UTF-8">
<script>

/// mazeStr is a newline separated maze, as generated by the
/// java function Maze::serialize
/// Call this function by opening the console and doing this:
/*

drawMaze(`fffff
fffff
fffff
fffff
fffff`);

*/


/*
    Given a string from Maze.serialize(), create a 2d array of integers.
    This function will error check the input maze.
    Refer to the Maze.java file for info on the coordinate system.

    Each element of the top level array is a column.
*/
function createMaze(serializedMaze) {
    const data =
        serializedMaze
        .trim().split('\n')
        .map(row => row.trim().split(''));
    // Ensure that each row in the serialization is the same length
    // and that each entry can be parsed as a valid maze number.
    const rows = data.length;
    const expectedCols = data[0].length;
    for (let i = 0; i < rows; i++) {

        const actualCols = data[i].length;
        if (actualCols !== expectedCols) {
            throw new Error('mismatched serialized maze size');
        }

        for (let j = 0; j < actualCols; j++) {
            const entry = parseInt(data[i][j], 16);
            if (isNaN(entry) || entry < 0 || entry >= 16) {
                throw new Error('invalid maze entry: ' + entry);
            }
            data[i][j] = entry | 0;
        }
    }

    // Now we convert data (which has been validated and is full of integers)
    // to the correct coordinate space (essentially, we transpose the matrix).
    const maze = [];
    // The number of columns in the old data is now the number of rows.
    for (let i = 0; i < expectedCols; i++) {
        maze.push([]);
    }
    // Perform the transpose
    for (let i = 0; i < rows; i++) {
        for (let j = 0; j < expectedCols; j++) {
            maze[j][i] = data[i][j];
        }
    }

    console.log(maze);

    return maze;
}

window.drawMaze = function(mazeStr) {
    const canvas = document.getElementById('maze');
    const ctx = canvas.getContext('2d');
    console.log(canvas.width, canvas.height);
    const maze = createMaze(mazeStr)
    const inset = 5;

    const usableWidth = canvas.width - (2 * inset);
    const usableHeight = canvas.height - (2 * inset);

    const cellWidth = usableWidth / maze.length;
    const cellHeight = usableHeight / maze[0].length;

    const NORTH = 1, EAST = 2, SOUTH = 4, WEST = 8;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.beginPath();
    // ctx.strokeStyle = "#2cd47d";
    ctx.strokeStyle = 'gray';
    ctx.lineWidth = 2;
    ctx.rect(inset, inset, usableWidth, usableHeight);
    ctx.stroke();

    ctx.beginPath();
    ctx.setLineDash([5, 3]);
    ctx.strokeStyle = 'gray';
    ctx.lineWidth = .5;
    for (let x = 0; x < maze.length; x++) {
        for (let y = 0; y < maze[x].length; y++) {
            ctx.rect(inset + x * cellWidth, inset + y * cellHeight, cellWidth, cellHeight);

        }
    }
    ctx.stroke();


    ctx.beginPath();
    ctx.strokeStyle = "#2cd47d";
    ctx.lineWidth = 5;
    ctx.lineCap = 'round';
    ctx.setLineDash([]);
    for (let x = 0; x < maze.length; x++) {
        for (let y = 0; y < maze[x].length; y++) {

            const value = maze[x][y];

            if ((value & NORTH) != 0) {
                ctx.moveTo(x * cellWidth + inset, y * cellHeight + inset);
                ctx.lineTo((x+1) * cellWidth + inset, (y) * cellHeight + inset);
            }
            if ((value & EAST) != 0) {
                ctx.moveTo((x+1) * cellWidth + inset, y * cellHeight + inset);
                ctx.lineTo((x+1) * cellWidth + inset, (y+1) * cellHeight);
            }
            if ((value & SOUTH) != 0) {
                ctx.moveTo(x * cellWidth + inset, (y+1) * cellHeight + inset);
                ctx.lineTo((x+1) * cellWidth + inset, (y+1) * cellHeight + inset);
            }

            if ((value & WEST) != 0) {
                ctx.moveTo((x) * cellWidth + inset, y * cellHeight + inset);
                ctx.lineTo((x) * cellWidth + inset, (y+1) * cellHeight + inset);
            }
        }
    }

    ctx.stroke();

};









</script>
</head>


<canvas style="margin:auto" id="maze" width="800" height="800"></canvas>

</html>
